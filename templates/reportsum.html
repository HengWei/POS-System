<!DOCTYPE html>
<html lang="en">
<head>
    {% load staticfiles %}
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex, nofollow">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Affogato Café POS System Demo Version</title>
    <link href="{% static "css/bootstrap.min.css" %}" rel="stylesheet">
    <link href="{% static "css/daterangepicker.css" %}" rel="stylesheet">
    <link href="{% static "css/navbar-static-top.css" %}" rel="stylesheet">
    <link href="{% static "css/highcharts.css" %}" rel="stylesheet">
    <link href="{% static "css/navbar.css" %}" rel="stylesheet">
    <link href="{% static "css/ie10-viewport-bug-workaround.css" %}" rel="stylesheet">

    {#<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>#}
    <script>window.jQuery || document.write('<script src={% static "js/jquery-3.2.0.min.js" %}><\/script>')</script>
    <script src={% static "js/bootstrap.min.js" %}></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="{% static "js/moment.js" %}"></script>
    <script src="{% static "js/daterangepicker.js" %}"></script>
    <script src=" {% static "js/jquery.blockUI.js" %} "></script>
    {#    <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.js"></script>#}
    {#    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>#}

    {#    <script type="text/javascript" src="{% static "js/highcharts.js" %}"></script>#}

    {#    <link href="{% static "js/jquery-1.11.3.min.js" %}" rel="stylesheet">#}
    {#    <link href="{% static "js/jquery.dataTables.min.js" %}" rel="stylesheet">#}

    {#    <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.15/css/jquery.dataTables.css">#}

    {#    <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.15/js/jquery.dataTables.js"></script>#}


    {#    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>#}
    <link href="{% static "js/ie-emulation-modes-warning.js" %}" rel="stylesheet">
    <style type="text/css">
        .demo {
            position: relative;
        }

        .demo i {
            position: absolute;
            bottom: 10px;
            right: 24px;
            top: auto;
            cursor: pointer;
        }
    </style>
    <script>
        $(document).ready(function () {
            Highcharts.chart('container', {
                chart: {
                    zoomType: 'xy'
                },
                title: {
                    text: '每日營業額'
                },
                subtitle: {
                    text: ''
                },
                xAxis: [{
                    categories: [
                        {% for item in data %}
                            '{{ item.date }}',
                        {% endfor %}
                    ],
                    crosshair: true
                }],
                yAxis: [{ // Primary yAxis
                    labels: {
                        format: '{value} 元',
                        style: {
                            color: Highcharts.getOptions().colors[1]
                        }
                    },
                    title: {
                        text: '客單價',
                        style: {
                            color: Highcharts.getOptions().colors[1]
                        }
                    }
                }, { // Secondary yAxis
                    title: {
                        text: '營業額',
                        style: {
                            color: Highcharts.getOptions().colors[0]
                        }
                    },
                    labels: {
                        format: '{value} 元',
                        style: {
                            color: Highcharts.getOptions().colors[0]
                        }
                    },
                    opposite: true
                }],
                tooltip: {
                    shared: true
                },
                legend: {
                    layout: 'vertical',
                    align: 'left',
                    x: 120,
                    verticalAlign: 'top',
                    y: 100,
                    floating: true,
                    backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF'
                },
                series: [{
                    name: '營業額',
                    type: 'column',
                    yAxis: 1,
                    data: [
                        {% for item in data %}
                            {{ item.total }},
                        {% endfor %}
                    ],
                    tooltip: {
                        valueSuffix: ' 元'
                    }

                }, {
                    name: '客單價',
                    type: 'spline',
                    data: [
                        {% for item in data %}
                            {{ item.avg }},
                        {% endfor %}

                    ],
                    tooltip: {
                        valueSuffix: ' 元/人'
                    }
                }]
            });


        });
    </script>
    <script>
        $(document).ready(function () {

            $('#config-demo').daterangepicker({
                "autoApply": true,
                "linkedCalendars": false,
                "startDate": "{{ startDate }}",
                "endDate": "{{ endDate }}",
                locale: {
                    format: 'YYYY/MM/DD'
                }
            }, function (start, end, label) {
                $.blockUI({message: '<h1><img src="{% static "img/712.gif" %}" /> &nbsp;&nbsp;資料讀取中...</h1>'});
                $('#startDate').val(start.format('YYYY/MM/DD'));
                $('#endDate').val(end.format('YYYY/MM/DD'));
                $('#postInfo').attr('action','/reportSum/');
                $('#postInfo').submit();
            });

            $('#SaveCSV').click(function(){
                $('#postInfo').attr('action','/downloadSellIncome/');
                $('#postInfo').submit();
            })
        });
    </script>

</head>


{#<script type="text/javascript" language="javascript"#}
{#        src="//cdn.datatables.net/responsive/1.0.0/js/dataTables.responsive.min.js"></script>#}

<body>
<div class="container">
    {% include 'navbar.html' %}
    <!-- Main component for a primary marketing message or call to action -->
    <div class="col-md-4 col-md-offset-0 demo">
        <h4>搜尋區間</h4>
        <input type="text" id="config-demo" class="form-control" value="{{ preDate }}">
        <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>

        <form id="postInfo" action="/reportSum/" method="post">
            {% csrf_token %}
            <input type="text" id="startDate" name="startDate" value="{{ startDate }}" hidden>
            <input type="text" id="endDate" name="endDate" value="{{ endDate }}" hidden>
            <input type="text" id="preDate" name="preDate" hidden>
        </form>
    </div>
    <div class="">
        <div id="container" style="min-width: 310px; height: 400px; max-width: 100%; margin: 0 auto"></div>
    </div>
    <hr>
    <br>
    <table class="table table-striped">
        <thead>
        <tr>
            <th>日期</th>
            <th>銷售額</th>
            <th>顧客數</th>
            <th>客單價</th>
            <th>翻桌率</th>
        </tr>
        </thead>
        <tbody>
        {% for item in data %}
            <tr>
                <td>{{ item.date }}</td>
                <td>{{ item.total }}</td>
                <td>{{ item.customer }}</td>
                <td>{{ item.avg }}</td>
                <td>{{ item.rate }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <center>
        <button id="SaveCSV" class="btn btn-lg">下載CSV檔</button>
    </center>
</div> <!-- /container -->


<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
{#<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>#}

<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src={% static "js/ie10-viewport-bug-workaround.js" %}></script>
</body>
</html>